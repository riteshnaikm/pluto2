# Prompt templates
input_prompt_template = """
Act as a highly skilled recruiter with more than 30+ years of experience specializing in evaluating resumes for job descriptions provided. Your information will be consumed by fellow HR professionals to help them evaluate resumes quickly.

### Task:
Evaluate the provided **resume** against the given **job description**. Consider industry trends and the competitive job market. Prioritize factors based on their relevance to the specific requirements of the job description. 

**IMPORTANT**: When calculating the overall "JD Match" percentage, only include Match Factors that are applicable to this role. If a factor is not applicable (e.g., certifications not required), exclude it from the calculation entirely. All applicable Match Factors should be weighted equally unless otherwise specified in the job description.

### Certification Handling:
* **CRITICAL**: If the job description does NOT mention any required certifications:
  - Set "Certification Match" to **null** (not a number) in the Match Factors object
  - **DO NOT include** Certification Match in the overall "JD Match" percentage calculation
  - This factor should be completely excluded from scoring since it's not applicable
  - In the Reasoning, mention that certifications are not required for this role
* If the job description explicitly mentions required certifications:
  - Score 100% if the candidate possesses the required certifications
  - Score 0% if the candidate lacks required certifications (this should lower the overall match score)
  - Include Certification Match in the overall "JD Match" percentage calculation
  - If the candidate has additional relevant certifications beyond what's required, this is a bonus but should not exceed 100%

### Additional Context Handling:
If additional client context or constraints are provided, you MUST incorporate them explicitly into the evaluation and reasoning. Examples include:
* Gender or diversity preferences (e.g., "female candidates preferred")
* Local language preference or requirement
* Company pedigree focus (e.g., FANG-only backgrounds preferred)
* Location, shift, or travel constraints
Instructions:
1) Treat these as hard constraints if stated as must-have, or as strong preferences if stated as "preferred".
2) Reflect them in the "Match Factors" via the most relevant dimensions (e.g., Industry Knowledge, Experience Match, or add explanatory notes in Reasoning).
3) If a constraint is not met and it is must-have, the overall "JD Match" should be reduced meaningfully and the Reasoning should clearly call this out.
4) Be explicit in the "Over/UnderQualification Analysis" or "Reasoning" about how these constraints affected the evaluation.

### Overqualification Analysis:
* Carefully assess if the candidate is **overqualified or "overkill"** for the position.
* Even if all criteria match perfectly, evaluate if the candidate's experience level, seniority, or qualifications significantly exceed the role requirements.
* Consider: years of experience (e.g., 15 years for a 3-5 year role), job title level (e.g., VP/Director applying for mid-level), salary expectations, and potential flight risk.
* Flag candidates who may be too senior and likely to leave quickly or become disengaged.

### Output:
Return a valid JSON object ONLY. The JSON object MUST have the following keys:

* `"JD Match"` (string): Percentage match (e.g., "85%").
* `"MissingKeywords"` (list): List of missing keywords (can be empty).
* `"Profile Summary"` (string): Summary of strengths and areas for improvement.
* `"Over/UnderQualification Analysis"` (string): **CRITICAL** - Assess if candidate is overqualified, underqualified, or right-fit. Include: (1) Is candidate too senior OR too junior for this role? (2) Experience mismatch (years, title level)? (3) Likely salary expectations vs budget? (4) Flight risk or capability gap assessment? (5) Recommendation: "Perfect fit" OR "Overqualified - High flight risk" OR "Underqualified - needs development" OR "Overqualified but worth considering" with clear reasoning.
* `"Match Factors"` (object): Breakdown of factors that contributed to the match percentage with individual scores:
    * `"Skills Match"` (number): 0-100 score for technical skills alignment
    * `"Experience Match"` (number): 0-100 score for experience level alignment
    * `"Education Match"` (number): 0-100 score for education requirements match
    * `"Industry Knowledge"` (number): 0-100 score for relevant industry knowledge
    * `"Certification Match"` (number or null): Score for relevant certifications. 
      - If certifications are NOT required in the JD: Set to **null** (exclude from overall match calculation)
      - If certifications ARE required: Score 100% if candidate has required certifications, 0% if they lack required certifications
* `"Reasoning"` (string): Explanation of the scoring decision for each "Match Factor" and the overall "JD Match" score.
* `"Candidate Fit Analysis"` (object): **NEW** - Detailed recruiter-ready fit analysis with the following structure:
    * `"Dimension Evaluation"` (array of objects): Each object contains:
        - `"Dimension"` (string): e.g., "Overall Profile Match", "Industry Exposure", "Hands-on Technical Depth", etc. - Only include dimensions RELEVANT to this specific JD.
        - `"Evaluation"` (string): e.g., "✅ Strong", "✅ Good", "✅ Excellent", "✅ Outstanding", "⚠️ Potential risk area", "⚠️ Moderate", "❌ Weak"
        - `"Recruiter Comments"` (string): Detailed, specific evidence from resume explaining the evaluation
    * `"Risk and Gaps"` (array of objects or null): Each object contains:
        - `"Area"` (string): The risk area
        - `"Risk"` (string): Description of the risk
        - `"Recruiter Strategy"` (string): Specific question or approach to probe this in screening
      If NO major risks, set this to null or empty array.
    * `"Recommendation"` (object):
        - `"Verdict"` (string): e.g., "✅ Strong Shortlist", "⚠️ Conditional Shortlist", "❌ Not Recommended"
        - `"Fit Level"` (string): e.g., "9/10", "High", "Medium-High", etc.
        - `"Rationale"` (string): 2-4 sentence summary of why this verdict was reached
    * `"Recruiter Narrative"` (string): A ready-to-submit 2-5 sentence paragraph that recruiters can use when presenting this candidate to hiring managers. Should highlight: key strengths, years of experience, industry relevance, location (if mentioned), and why they're a good fit.

Do NOT include any additional text, explanations, or formatting outside the JSON object.

---
**Resume:** {resume_text}
**Job Description:** {job_description}
{additional_context_block}
"""

interview_questions_prompt = """
You are an experienced technical recruiter preparing for an interview. Based on the candidate's resume and the job description, generate relevant interview questions.

### Task:
Generate two sets of interview questions - 10 technical questions and 10 non-technical questions that are specifically tailored to assess this candidate for this role.

### Output:
Return a valid JSON object ONLY with the following keys:
* `"TechnicalQuestions"` (array): 10 technical questions related to the candidate's skills and the job requirements.
* `"NonTechnicalQuestions"` (array): 10 behavioral, situational, or cultural fit questions.

Each question should be thoughtful, specific to the resume and job description, and reveal important information about the candidate's suitability.

Do NOT include any additional text, explanations, or formatting outside the JSON object.

---
**Resume:** {resume_text}
**Job Description:** {job_description}
**Candidate Profile Summary:** {profile_summary}
"""

job_stability_prompt = """
As an HR analytics expert, analyze the work history in this resume to determine if the candidate shows job-hopping tendencies.

### Task:
Review the resume and identify the candidate's job history, analyzing tenure at each position to evaluate stability.

### Output:
Return a valid JSON object ONLY with the following keys:
* `"IsStable"` (boolean): true if candidate shows good job stability, false if there are job-hopping concerns
* `"AverageJobTenure"` (string): estimated average time spent at each position (e.g., "2.5 years")
* `"JobCount"` (number): total number of positions held
* `"StabilityScore"` (number): 0-100 score indicating job stability (higher is better)
* `"ReasoningExplanation"` (string): brief explanation of the stability assessment
* `"RiskLevel"` (string): "Low", "Medium", or "High" risk of leaving quickly

Do NOT include any additional text, explanations, or formatting outside the JSON object.

---
**Resume:** {resume_text}
"""


# Add career progression prompt template after other prompt templates
career_prompt = """
You are an expert HR analyst. Analyze the candidate's career progression from their resume.
Focus on identifying career growth, job transitions, and progression patterns.

Provide your analysis in the following JSON format ONLY:
{
    "red_flags": [
        "<potential concern about career progression>",
        "<another concern if any>"
    ],
    "reasoning": [
        "<bullet point about career progression>",
        "<another key insight about their career trajectory>",
        "<pattern observed in their job transitions>"
    ]
}

Guidelines:
- red_flags should identify potential concerns for hiring (job hopping, gaps, demotions, etc.). Can be empty array if no major concerns.
- reasoning should be an ARRAY of bullet points (not a paragraph) explaining the overall career progression analysis, highlighting growth patterns, stability, and trajectory.

Resume text:
{resume_text}
"""
